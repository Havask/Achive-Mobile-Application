{"ast":null,"code":"import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import dayjs from\"dayjs\";import*as React from\"react\";import{useEffect,useRef,useState,useContext,useCallback}from\"react\";import ActivityIndicator from\"react-native-web/dist/exports/ActivityIndicator\";import Alert from\"react-native-web/dist/exports/Alert\";import AppRegistry from\"react-native-web/dist/exports/AppRegistry\";import Image from\"react-native-web/dist/exports/Image\";import Platform from\"react-native-web/dist/exports/Platform\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import Text from\"react-native-web/dist/exports/Text\";import{ChatEmitter,Chatty}from\"react-native-chatty\";import{GestureHandlerRootView}from\"react-native-gesture-handler\";import{initialWindowMetrics,SafeAreaProvider}from\"react-native-safe-area-context\";import ContextMenu from\"react-native-context-menu-view\";import{GroupContext}from\"../../../context/GroupContext\";import{FirebaseContext}from\"../../../context/FirebaseContext\";import{UserContext}from\"../../../context/UserContext\";import{jsx as _jsx}from\"react/jsx-runtime\";export default ChatScreen=function ChatScreen(_ref){var navigation=_ref.navigation;var firebase=useContext(FirebaseContext);var _useContext=useContext(UserContext),_useContext2=_slicedToArray(_useContext,2),user=_useContext2[0],setUser=_useContext2[1];var _useContext3=useContext(GroupContext),_useContext4=_slicedToArray(_useContext3,2),group=_useContext4[0],setGroup=_useContext4[1];var listRef=useRef(null);var message=useRef();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),replying=_useState2[0],setReplying=_useState2[1];var _useState3=useState([{id:1,text:\"Hello!\",me:true,createdAt:new Date(),user:{id:1,username:\"John Doe\",avatar:{uri:\"https://i.pravatar.cc/300\"}}},{id:2,text:\"Hello john! how are you?\",me:false,createdAt:new Date(),user:{id:2,username:\"Jane Doe\",avatar:{uri:\"https://i.pravatar.cc/300\"}},repliedTo:{id:1,text:\"Hello!\",me:true,createdAt:new Date(),user:{id:1,username:\"John Doe\",avatar:{uri:\"https://i.pravatar.cc/300\"}}}},{id:8,text:\"I'm fine thanks! What about you?\",me:true,createdAt:new Date(),user:{id:2,username:\"Jane Doe\",avatar:{uri:\"https://i.pravatar.cc/300\"}}}]),_useState4=_slicedToArray(_useState3,2),messages=_useState4[0],setMessages=_useState4[1];useEffect(function(){ChatEmitter==null?void 0:ChatEmitter.addListener(\"patternPressed\",function(pattern){Alert.alert(\"Pattern pressed\",pattern);});var _messages=[];setMessages([].concat(_toConsumableArray(messages),_messages));return function(){ChatEmitter.removeAllListeners();};},[]);var onLoadEarlier=function onLoadEarlier(){return new Promise(function(resolve){setMessages(function(prev){return[{id:1203,text:\"I'm loaded!\",me:true,createdAt:dayjs().add(-5,\"day\").toDate(),user:{id:1,username:group.groupname,avatar:{uri:\"https://i.pravatar.cc/300\"}}}].concat(_toConsumableArray(prev));});setTimeout(function(){resolve(true);},300);});};var onPressSend=useCallback(function(_ref2){var text=_ref2.text,repliedTo=_ref2.repliedTo;listRef.current.appendMessage({id:messages.length+1,text:text,me:Math.floor(Math.random()*2)===0,createdAt:new Date(),user:{id:messages.length+1,name:user.username,avatar:{uri:\"https://i.pravatar.cc/300\"}},repliedTo:repliedTo});listRef.current.setIsTyping(false);setReplying(null);},[messages]);var onChangeText=useCallback(function(text){message.current=text;listRef.current.setIsTyping(text.length>0);},[]);if(messages.length<1)return _jsx(ActivityIndicator,{});return _jsx(SafeAreaProvider,{initialMetrics:initialWindowMetrics,children:_jsx(GestureHandlerRootView,{children:_jsx(Chatty,{enableHapticFeedback:true,messages:messages,ref:listRef,enablePatterns:true,patternProps:{allowPatterns:[\"mention\"]},showScrollToBottomButton:true,bubbleProps:{replyDragElement:_jsx(Image,{source:{uri:\"https://icon-library.com/images/reply-icon-png/reply-icon-png-16.jpg\"},style:{width:30,height:30}})},footerProps:{onPressSend:onPressSend,onPressCancelReply:function onPressCancelReply(){return setReplying(null);},onChangeText:onChangeText},loadEarlierProps:{onLoadEarlier:onLoadEarlier,show:messages.length===10?false:true},onReply:function onReply(_message){setReplying(_message);},renderTypingBubble:function renderTypingBubble(){return _jsx(Text,{children:\"Custom View (Typing...)\"});},replyingTo:replying!=null?replying:undefined,headerProps:{user:{id:0,username:user.username,avatar:{uri:user.profilePhotoUrl}}}})})});};","map":{"version":3,"names":["dayjs","React","useEffect","useRef","useState","useContext","useCallback","ChatEmitter","Chatty","GestureHandlerRootView","initialWindowMetrics","SafeAreaProvider","ContextMenu","GroupContext","FirebaseContext","UserContext","ChatScreen","navigation","firebase","user","setUser","group","setGroup","listRef","message","replying","setReplying","id","text","me","createdAt","Date","username","avatar","uri","repliedTo","messages","setMessages","addListener","pattern","Alert","alert","_messages","removeAllListeners","onLoadEarlier","Promise","resolve","prev","add","toDate","groupname","setTimeout","onPressSend","current","appendMessage","length","Math","floor","random","name","setIsTyping","onChangeText","allowPatterns","replyDragElement","width","height","onPressCancelReply","show","_message","undefined","profilePhotoUrl"],"sources":["/Users/havardskjaerstein/Desktop/Achive/screens/GroupTab/GroupScreens/ChatScreen.js"],"sourcesContent":["import dayjs from \"dayjs\";\nimport * as React from \"react\";\nimport { useEffect, useRef, useState, useContext, useCallback} from \"react\";\nimport {\n  ActivityIndicator,\n  Alert,\n  AppRegistry,\n  Image,\n  Platform,\n  TouchableOpacity,\n  Text, \n} from \"react-native\";\nimport { ChatEmitter, Chatty } from \"react-native-chatty\";\nimport { GestureHandlerRootView } from \"react-native-gesture-handler\";\nimport {\n  initialWindowMetrics,\n  SafeAreaProvider,\n} from \"react-native-safe-area-context\";\nimport ContextMenu from \"react-native-context-menu-view\";\n\nimport {GroupContext} from \"../../../context/GroupContext\";\nimport {FirebaseContext} from \"../../../context/FirebaseContext\";\nimport {UserContext} from \"../../../context/UserContext\";\n\n/*\nhttps://snack.expo.dev/@muhammedkpln/react-native-chatty-example\nhttps://css-tricks.com/building-a-real-time-chat-app-with-react-and-firebase/\n*/ \nexport default ChatScreen = ({navigation}) => {\n\n  const firebase = useContext(FirebaseContext); \n  const [user, setUser] = useContext(UserContext); \n  const [group, setGroup] = useContext(GroupContext); \n\n  const listRef = useRef(null);\n  const message = useRef();\n  const [replying, setReplying] = useState(null);\n\n\n  const [messages, setMessages] = useState([\n    {\n      id: 1,\n      text: \"Hello!\",\n      me: true,\n      createdAt: new Date(),\n      user: {\n        id: 1,\n        username: \"John Doe\",\n        avatar: { uri: \"https://i.pravatar.cc/300\" },\n      },\n    },\n    {\n      id: 2,\n      text: \"Hello john! how are you?\",\n      me: false,\n      createdAt: new Date(),\n      user: {\n        id: 2,\n        username: \"Jane Doe\",\n        avatar: { uri: \"https://i.pravatar.cc/300\" },\n      },\n      repliedTo: {\n        id: 1,\n        text: \"Hello!\",\n        me: true,\n        createdAt: new Date(),\n        user: {\n          id: 1,\n          username: \"John Doe\",\n          avatar: { uri: \"https://i.pravatar.cc/300\" },\n        },\n      },\n    },\n    {\n      id: 8,\n      text: \"I'm fine thanks! What about you?\",\n      me: true,\n      createdAt: new Date(),\n      user: {\n        id: 2,\n        username: \"Jane Doe\",\n        avatar: { uri: \"https://i.pravatar.cc/300\" },\n      },\n    },\n  ]);\n\n  useEffect(() => {\n    ChatEmitter?.addListener(\"patternPressed\", (pattern) => {\n      Alert.alert(\"Pattern pressed\", pattern);\n    });\n\n    const _messages = [];\n\n    setMessages([...messages, ..._messages]);\n\n    return () => {\n      ChatEmitter.removeAllListeners();\n    };\n  }, []);\n\n  const onLoadEarlier = () => {\n    return new Promise((resolve) => {\n      setMessages((prev) => [\n        ...[\n          {\n            id: 1203,\n            text: \"I'm loaded!\",\n            me: true,\n            createdAt: dayjs().add(-5, \"day\").toDate(),\n            user: {\n              id: 1,\n              username: group.groupname,\n              avatar: { uri: \"https://i.pravatar.cc/300\" },\n            },\n          },\n        ],\n        ...prev,\n      ]);\n\n      setTimeout(() => {\n        resolve(true);\n      }, 300);\n    });\n  };\n\n  const onPressSend = useCallback(\n    ({ text, repliedTo }) => {\n      listRef.current.appendMessage({\n        id: messages.length + 1,\n        text,\n        me: Math.floor(Math.random() * 2) === 0,\n        createdAt: new Date(),\n        user: {\n          id: messages.length + 1,\n          name: user.username, \n          avatar: { uri: \"https://i.pravatar.cc/300\" },\n        },\n        repliedTo,\n      });\n\n      listRef.current.setIsTyping(false);\n      setReplying(null);\n    },\n    [messages],\n  );\n\n  const onChangeText = useCallback((text) => {\n    message.current = text;\n    //@ts-ignore\n    listRef.current.setIsTyping(text.length > 0);\n  }, []);\n\n  if (messages.length < 1) return <ActivityIndicator />;\n\n  return (\n    <SafeAreaProvider initialMetrics={initialWindowMetrics}>\n      <GestureHandlerRootView>\n        <Chatty\n          enableHapticFeedback\n          messages={messages}\n          ref={listRef}\n          enablePatterns\n          patternProps={{\n            allowPatterns: [\"mention\"],\n          }}\n          showScrollToBottomButton\n          bubbleProps={{\n            replyDragElement: (\n              <Image\n                source={{\n                  uri: \"https://icon-library.com/images/reply-icon-png/reply-icon-png-16.jpg\",\n                }}\n                style={{ width: 30, height: 30 }}\n              />\n            ),\n          }}\n          footerProps={{\n            onPressSend: onPressSend,\n            onPressCancelReply: () => setReplying(null),\n            onChangeText: onChangeText,\n          }}\n          loadEarlierProps={{\n            onLoadEarlier: onLoadEarlier,\n            show: messages.length === 10 ? false : true,\n          }}\n          onReply={(_message) => {\n            setReplying(_message);\n          }}\n          renderTypingBubble={() => <Text>Custom View (Typing...)</Text>}\n          replyingTo={replying ?? undefined}\n          headerProps={{\n            user: {\n              id: 0,\n              username: user.username,\n              avatar:  { uri: user.profilePhotoUrl}\n            },\n          }}\n        />\n      </GestureHandlerRootView>\n    </SafeAreaProvider>\n  );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}