{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";var _MediaTypeInput;function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}import _regeneratorRuntime from\"@babel/runtime/regenerator\";import{PermissionStatus,Platform}from'expo-modules-core';import{v4}from'uuid';import{MediaTypeOptions}from\"./ImagePicker.types\";var MediaTypeInput=(_MediaTypeInput={},_defineProperty(_MediaTypeInput,MediaTypeOptions.All,'video/mp4,video/quicktime,video/x-m4v,video/*,image/*'),_defineProperty(_MediaTypeInput,MediaTypeOptions.Images,'image/*'),_defineProperty(_MediaTypeInput,MediaTypeOptions.Videos,'video/mp4,video/quicktime,video/x-m4v,video/*'),_MediaTypeInput);export default{get name(){return'ExponentImagePicker';},launchImageLibraryAsync:function launchImageLibraryAsync(_ref){return function _callee(){var _ref$mediaTypes,mediaTypes,_ref$allowsMultipleSe,allowsMultipleSelection,_ref$base,base64;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_ref$mediaTypes=_ref.mediaTypes,mediaTypes=_ref$mediaTypes===void 0?MediaTypeOptions.Images:_ref$mediaTypes,_ref$allowsMultipleSe=_ref.allowsMultipleSelection,allowsMultipleSelection=_ref$allowsMultipleSe===void 0?false:_ref$allowsMultipleSe,_ref$base=_ref.base64,base64=_ref$base===void 0?false:_ref$base;if(Platform.isDOMAvailable){_context.next=3;break;}return _context.abrupt(\"return\",{cancelled:true});case 3:_context.next=5;return _regeneratorRuntime.awrap(openFileBrowserAsync({mediaTypes:mediaTypes,allowsMultipleSelection:allowsMultipleSelection,base64:base64}));case 5:return _context.abrupt(\"return\",_context.sent);case 6:case\"end\":return _context.stop();}}},null,null,null,Promise);}();},launchCameraAsync:function launchCameraAsync(_ref2){return function _callee2(){var _ref2$mediaTypes,mediaTypes,_ref2$allowsMultipleS,allowsMultipleSelection,_ref2$base,base64;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_ref2$mediaTypes=_ref2.mediaTypes,mediaTypes=_ref2$mediaTypes===void 0?MediaTypeOptions.Images:_ref2$mediaTypes,_ref2$allowsMultipleS=_ref2.allowsMultipleSelection,allowsMultipleSelection=_ref2$allowsMultipleS===void 0?false:_ref2$allowsMultipleS,_ref2$base=_ref2.base64,base64=_ref2$base===void 0?false:_ref2$base;if(Platform.isDOMAvailable){_context2.next=3;break;}return _context2.abrupt(\"return\",{cancelled:true});case 3:_context2.next=5;return _regeneratorRuntime.awrap(openFileBrowserAsync({mediaTypes:mediaTypes,allowsMultipleSelection:allowsMultipleSelection,capture:true,base64:base64}));case 5:return _context2.abrupt(\"return\",_context2.sent);case 6:case\"end\":return _context2.stop();}}},null,null,null,Promise);}();},getCameraPermissionsAsync:function getCameraPermissionsAsync(){return function _callee3(){return _regeneratorRuntime.async(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",permissionGrantedResponse());case 1:case\"end\":return _context3.stop();}}},null,null,null,Promise);}();},requestCameraPermissionsAsync:function requestCameraPermissionsAsync(){return function _callee4(){return _regeneratorRuntime.async(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",permissionGrantedResponse());case 1:case\"end\":return _context4.stop();}}},null,null,null,Promise);}();},getMediaLibraryPermissionsAsync:function getMediaLibraryPermissionsAsync(_writeOnly){return function _callee5(){return _regeneratorRuntime.async(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\",permissionGrantedResponse());case 1:case\"end\":return _context5.stop();}}},null,null,null,Promise);}();},requestMediaLibraryPermissionsAsync:function requestMediaLibraryPermissionsAsync(_writeOnly){return function _callee6(){return _regeneratorRuntime.async(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:return _context6.abrupt(\"return\",permissionGrantedResponse());case 1:case\"end\":return _context6.stop();}}},null,null,null,Promise);}();}};function permissionGrantedResponse(){return{status:PermissionStatus.GRANTED,expires:'never',granted:true,canAskAgain:true};}function openFileBrowserAsync(_ref3){var mediaTypes=_ref3.mediaTypes,_ref3$capture=_ref3.capture,capture=_ref3$capture===void 0?false:_ref3$capture,_ref3$allowsMultipleS=_ref3.allowsMultipleSelection,allowsMultipleSelection=_ref3$allowsMultipleS===void 0?false:_ref3$allowsMultipleS,base64=_ref3.base64;var mediaTypeFormat=MediaTypeInput[mediaTypes];var input=document.createElement('input');input.style.display='none';input.setAttribute('type','file');input.setAttribute('accept',mediaTypeFormat);input.setAttribute('id',v4());if(allowsMultipleSelection){input.setAttribute('multiple','multiple');}if(capture){input.setAttribute('capture','camera');}document.body.appendChild(input);return new Promise(function(resolve,reject){input.addEventListener('change',function _callee7(){var img,imgs;return _regeneratorRuntime.async(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(!input.files){_context7.next=12;break;}if(allowsMultipleSelection){_context7.next=8;break;}_context7.next=4;return _regeneratorRuntime.awrap(readFile(input.files[0],{base64:base64}));case 4:img=_context7.sent;resolve(_objectSpread({},img));_context7.next=12;break;case 8:_context7.next=10;return _regeneratorRuntime.awrap(Promise.all(Array.from(input.files).map(function(file){return readFile(file,{base64:base64});})));case 10:imgs=_context7.sent;resolve({cancelled:false,selected:imgs});case 12:document.body.removeChild(input);case 13:case\"end\":return _context7.stop();}}},null,null,null,Promise);});var event=new MouseEvent('click');input.dispatchEvent(event);});}function readFile(targetFile,options){return new Promise(function(resolve,reject){var reader=new FileReader();reader.onerror=function(){reject(new Error(\"Failed to read the selected media because the operation failed.\"));};reader.onload=function(_ref4){var target=_ref4.target;var uri=target.result;var returnRaw=function returnRaw(){return resolve({uri:uri,width:0,height:0,cancelled:false});};if(typeof uri==='string'){var image=new Image();image.src=uri;image.onload=function(){var _image$naturalWidth,_image$naturalHeight;return resolve(_objectSpread({uri:uri,width:(_image$naturalWidth=image.naturalWidth)!=null?_image$naturalWidth:image.width,height:(_image$naturalHeight=image.naturalHeight)!=null?_image$naturalHeight:image.height,cancelled:false},options.base64&&{base64:uri.substr(uri.indexOf(',')+1)}));};image.onerror=function(){return returnRaw();};}else{returnRaw();}};reader.readAsDataURL(targetFile);});}","map":{"version":3,"mappings":"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","names":["PermissionStatus","Platform","v4","MediaTypeOptions","MediaTypeInput","All","Images","Videos","name","launchImageLibraryAsync","mediaTypes","allowsMultipleSelection","base64","isDOMAvailable","cancelled","openFileBrowserAsync","launchCameraAsync","capture","getCameraPermissionsAsync","permissionGrantedResponse","requestCameraPermissionsAsync","getMediaLibraryPermissionsAsync","_writeOnly","requestMediaLibraryPermissionsAsync","status","GRANTED","expires","granted","canAskAgain","mediaTypeFormat","input","document","createElement","style","display","setAttribute","body","appendChild","Promise","resolve","reject","addEventListener","files","readFile","img","all","Array","from","map","file","imgs","selected","removeChild","event","MouseEvent","dispatchEvent","targetFile","options","reader","FileReader","onerror","Error","onload","target","uri","result","returnRaw","width","height","image","Image","src","naturalWidth","naturalHeight","substr","indexOf","readAsDataURL"],"sourceRoot":"","sources":["../src/ExponentImagePicker.web.ts"],"sourcesContent":["import { PermissionResponse, PermissionStatus, Platform } from 'expo-modules-core';\nimport { v4 } from 'uuid';\n\nimport {\n  ExpandImagePickerResult,\n  ImageInfo,\n  ImagePickerMultipleResult,\n  ImagePickerResult,\n  MediaTypeOptions,\n  OpenFileBrowserOptions,\n} from './ImagePicker.types';\n\nconst MediaTypeInput = {\n  [MediaTypeOptions.All]: 'video/mp4,video/quicktime,video/x-m4v,video/*,image/*',\n  [MediaTypeOptions.Images]: 'image/*',\n  [MediaTypeOptions.Videos]: 'video/mp4,video/quicktime,video/x-m4v,video/*',\n};\n\nexport default {\n  get name(): string {\n    return 'ExponentImagePicker';\n  },\n\n  async launchImageLibraryAsync({\n    mediaTypes = MediaTypeOptions.Images,\n    allowsMultipleSelection = false,\n    base64 = false,\n  }): Promise<ImagePickerResult | ImagePickerMultipleResult> {\n    // SSR guard\n    if (!Platform.isDOMAvailable) {\n      return { cancelled: true };\n    }\n    return await openFileBrowserAsync({\n      mediaTypes,\n      allowsMultipleSelection,\n      base64,\n    });\n  },\n\n  async launchCameraAsync({\n    mediaTypes = MediaTypeOptions.Images,\n    allowsMultipleSelection = false,\n    base64 = false,\n  }): Promise<ImagePickerResult | ImagePickerMultipleResult> {\n    // SSR guard\n    if (!Platform.isDOMAvailable) {\n      return { cancelled: true };\n    }\n    return await openFileBrowserAsync({\n      mediaTypes,\n      allowsMultipleSelection,\n      capture: true,\n      base64,\n    });\n  },\n\n  /*\n   * Delegate to expo-permissions to request camera permissions\n   */\n  async getCameraPermissionsAsync() {\n    return permissionGrantedResponse();\n  },\n  async requestCameraPermissionsAsync() {\n    return permissionGrantedResponse();\n  },\n\n  /*\n   * Camera roll permissions don't need to be requested on web, so we always\n   * respond with granted.\n   */\n  async getMediaLibraryPermissionsAsync(_writeOnly: boolean) {\n    return permissionGrantedResponse();\n  },\n  async requestMediaLibraryPermissionsAsync(_writeOnly: boolean): Promise<PermissionResponse> {\n    return permissionGrantedResponse();\n  },\n};\n\nfunction permissionGrantedResponse(): PermissionResponse {\n  return {\n    status: PermissionStatus.GRANTED,\n    expires: 'never',\n    granted: true,\n    canAskAgain: true,\n  };\n}\n\nfunction openFileBrowserAsync<T extends OpenFileBrowserOptions>({\n  mediaTypes,\n  capture = false,\n  allowsMultipleSelection = false,\n  base64,\n}: T): Promise<ExpandImagePickerResult<T>> {\n  const mediaTypeFormat = MediaTypeInput[mediaTypes];\n\n  const input = document.createElement('input');\n  input.style.display = 'none';\n  input.setAttribute('type', 'file');\n  input.setAttribute('accept', mediaTypeFormat);\n  input.setAttribute('id', v4());\n  if (allowsMultipleSelection) {\n    input.setAttribute('multiple', 'multiple');\n  }\n  if (capture) {\n    input.setAttribute('capture', 'camera');\n  }\n  document.body.appendChild(input);\n\n  return new Promise((resolve, reject) => {\n    input.addEventListener('change', async () => {\n      if (input.files) {\n        if (!allowsMultipleSelection) {\n          const img: ImageInfo = await readFile(input.files[0], { base64 });\n          resolve({\n            ...img,\n          } as ExpandImagePickerResult<T>);\n        } else {\n          const imgs: ImageInfo[] = await Promise.all(\n            Array.from(input.files).map((file) => readFile(file, { base64 }))\n          );\n          resolve({\n            cancelled: false,\n            selected: imgs,\n          } as ExpandImagePickerResult<T>);\n        }\n      }\n      document.body.removeChild(input);\n    });\n\n    const event = new MouseEvent('click');\n    input.dispatchEvent(event);\n  });\n}\n\nfunction readFile(targetFile: Blob, options: { base64: boolean }): Promise<ImageInfo> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onerror = () => {\n      reject(new Error(`Failed to read the selected media because the operation failed.`));\n    };\n    reader.onload = ({ target }) => {\n      const uri = (target as any).result;\n      const returnRaw = () =>\n        resolve({\n          uri,\n          width: 0,\n          height: 0,\n          cancelled: false,\n        });\n\n      if (typeof uri === 'string') {\n        const image = new Image();\n        image.src = uri;\n        image.onload = () =>\n          resolve({\n            uri,\n            width: image.naturalWidth ?? image.width,\n            height: image.naturalHeight ?? image.height,\n            cancelled: false,\n            // The blob's result cannot be directly decoded as Base64 without\n            // first removing the Data-URL declaration preceding the\n            // Base64-encoded data. To retrieve only the Base64 encoded string,\n            // first remove data:*/*;base64, from the result.\n            // https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsDataURL\n            ...(options.base64 && { base64: uri.substr(uri.indexOf(',') + 1) }),\n          });\n        image.onerror = () => returnRaw();\n      } else {\n        returnRaw();\n      }\n    };\n\n    reader.readAsDataURL(targetFile);\n  });\n}\n"]},"metadata":{},"sourceType":"module"}