{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import{PermissionStatus,UnavailabilityError}from'expo-modules-core';function getUserMedia(constraints){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){return navigator.mediaDevices.getUserMedia(constraints);}var getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||function(){var error=new Error('Permission unimplemented');error.code=0;error.name='NotAllowedError';throw error;};return new Promise(function(resolve,reject){getUserMedia.call(navigator,constraints,resolve,reject);});}function handleGetUserMediaError(_ref){var message=_ref.message;if(message==='Permission dismissed'){return{status:PermissionStatus.UNDETERMINED,expires:'never',canAskAgain:true,granted:false};}else{return{status:PermissionStatus.DENIED,expires:'never',canAskAgain:true,granted:false};}}function handleRequestPermissionsAsync(){var message;return _regeneratorRuntime.async(function handleRequestPermissionsAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _regeneratorRuntime.awrap(getUserMedia({video:true}));case 3:return _context.abrupt(\"return\",{status:PermissionStatus.GRANTED,expires:'never',canAskAgain:true,granted:true});case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);message=_context.t0.message;return _context.abrupt(\"return\",handleGetUserMediaError({message:message}));case 10:case\"end\":return _context.stop();}}},null,null,[[0,6]],Promise);}function handlePermissionsQueryAsync(){var _navigator,_navigator$permission;var _await$navigator$perm,state;return _regeneratorRuntime.async(function handlePermissionsQueryAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if((_navigator=navigator)!=null&&(_navigator$permission=_navigator.permissions)!=null&&_navigator$permission.query){_context2.next=2;break;}throw new UnavailabilityError('expo-barcode-scanner','navigator.permissions API is not available');case 2:_context2.next=4;return _regeneratorRuntime.awrap(navigator.permissions.query({name:'camera'}));case 4:_await$navigator$perm=_context2.sent;state=_await$navigator$perm.state;_context2.t0=state;_context2.next=_context2.t0==='prompt'?9:_context2.t0==='granted'?10:_context2.t0==='denied'?11:12;break;case 9:return _context2.abrupt(\"return\",{status:PermissionStatus.UNDETERMINED,expires:'never',canAskAgain:true,granted:false});case 10:return _context2.abrupt(\"return\",{status:PermissionStatus.GRANTED,expires:'never',canAskAgain:true,granted:true});case 11:return _context2.abrupt(\"return\",{status:PermissionStatus.DENIED,expires:'never',canAskAgain:true,granted:false});case 12:case\"end\":return _context2.stop();}}},null,null,null,Promise);}export default{get name(){return'ExpoBarCodeScannerModule';},get BarCodeType(){return{code39mod43:'code39mod43',code138:'code138',interleaved2of5:'interleaved2of5',aztec:'aztec',ean13:'ean13',ean8:'ean8',qr:'qr',pdf417:'pdf417',upc_e:'upc_e',datamatrix:'datamatrix',code39:'code39',code93:'code93',itf14:'itf14',codabar:'codabar',code128:'code128',upc_a:'upc_a'};},get Type(){return{front:'front',back:'back'};},requestPermissionsAsync:function requestPermissionsAsync(){return function _callee(){return _regeneratorRuntime.async(function _callee$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",handleRequestPermissionsAsync());case 1:case\"end\":return _context3.stop();}}},null,null,null,Promise);}();},getPermissionsAsync:function getPermissionsAsync(){return function _callee2(){return _regeneratorRuntime.async(function _callee2$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",handlePermissionsQueryAsync());case 1:case\"end\":return _context4.stop();}}},null,null,null,Promise);}();}};","map":{"version":3,"mappings":"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","names":["PermissionStatus","UnavailabilityError","getUserMedia","constraints","navigator","mediaDevices","webkitGetUserMedia","mozGetUserMedia","error","Error","code","name","Promise","resolve","reject","call","handleGetUserMediaError","message","status","UNDETERMINED","expires","canAskAgain","granted","DENIED","handleRequestPermissionsAsync","video","GRANTED","handlePermissionsQueryAsync","permissions","query","state","BarCodeType","code39mod43","code138","interleaved2of5","aztec","ean13","ean8","qr","pdf417","upc_e","datamatrix","code39","code93","itf14","codabar","code128","upc_a","Type","front","back","requestPermissionsAsync","getPermissionsAsync"],"sourceRoot":"","sources":["../src/ExpoBarCodeScannerModule.web.ts"],"sourcesContent":["import { PermissionResponse, PermissionStatus, UnavailabilityError } from 'expo-modules-core';\n\nfunction getUserMedia(constraints: MediaStreamConstraints): Promise<MediaStream> {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  // Some browsers partially implement mediaDevices. We can't just assign an object\n  // with getUserMedia as it would overwrite existing properties.\n  // Here, we will just add the getUserMedia property if it's missing.\n\n  // First get ahold of the legacy getUserMedia, if present\n  const getUserMedia =\n    // TODO: this method is deprecated, migrate to https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n    navigator.getUserMedia ||\n    navigator.webkitGetUserMedia ||\n    navigator.mozGetUserMedia ||\n    function () {\n      const error: any = new Error('Permission unimplemented');\n      error.code = 0;\n      error.name = 'NotAllowedError';\n      throw error;\n    };\n\n  return new Promise((resolve, reject) => {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nfunction handleGetUserMediaError({ message }: { message: string }): PermissionResponse {\n  // name: NotAllowedError\n  // code: 0\n  if (message === 'Permission dismissed') {\n    return {\n      status: PermissionStatus.UNDETERMINED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: false,\n    };\n  } else {\n    return {\n      status: PermissionStatus.DENIED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: false,\n    };\n  }\n}\n\nasync function handleRequestPermissionsAsync(): Promise<PermissionResponse> {\n  try {\n    await getUserMedia({\n      video: true,\n    });\n    return {\n      status: PermissionStatus.GRANTED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: true,\n    };\n  } catch ({ message }) {\n    return handleGetUserMediaError({ message });\n  }\n}\n\nasync function handlePermissionsQueryAsync(): Promise<PermissionResponse> {\n  if (!navigator?.permissions?.query) {\n    throw new UnavailabilityError(\n      'expo-barcode-scanner',\n      'navigator.permissions API is not available'\n    );\n  }\n\n  const { state } = await navigator.permissions.query({ name: 'camera' });\n  switch (state) {\n    case 'prompt':\n      return {\n        status: PermissionStatus.UNDETERMINED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    case 'granted':\n      return {\n        status: PermissionStatus.GRANTED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: true,\n      };\n    case 'denied':\n      return {\n        status: PermissionStatus.DENIED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n  }\n}\n\nexport default {\n  get name(): string {\n    return 'ExpoBarCodeScannerModule';\n  },\n  get BarCodeType() {\n    return {\n      code39mod43: 'code39mod43',\n      code138: 'code138',\n      interleaved2of5: 'interleaved2of5',\n      aztec: 'aztec',\n      ean13: 'ean13',\n      ean8: 'ean8',\n      qr: 'qr',\n      pdf417: 'pdf417',\n      upc_e: 'upc_e',\n      datamatrix: 'datamatrix',\n      code39: 'code39',\n      code93: 'code93',\n      itf14: 'itf14',\n      codabar: 'codabar',\n      code128: 'code128',\n      upc_a: 'upc_a',\n    };\n  },\n  get Type() {\n    return { front: 'front', back: 'back' };\n  },\n  async requestPermissionsAsync(): Promise<PermissionResponse> {\n    return handleRequestPermissionsAsync();\n  },\n  async getPermissionsAsync(): Promise<PermissionResponse> {\n    return handlePermissionsQueryAsync();\n  },\n};\n"]},"metadata":{},"sourceType":"module"}