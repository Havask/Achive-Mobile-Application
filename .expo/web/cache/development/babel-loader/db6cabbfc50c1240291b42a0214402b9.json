{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport dayjs from 'dayjs';\nimport React, { useCallback, useContext, useEffect, useMemo, useState } from 'react';\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport InteractionManager from \"react-native-web/dist/exports/InteractionManager\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport View from \"react-native-web/dist/exports/View\";\nimport { PropsContext } from \"./Chatty\";\nimport { PhotoView } from \"./components/PhotoView\";\nimport { ReplyingTo } from \"./components/ReplyingTo\";\nimport { UrlPreviewBubble } from \"./components/UrlPreviewBubble\";\nimport { VideoThumbnail } from \"./components/VideoThumbnail\";\nimport { MediaType, MessageStatus } from \"./types/Chatty.types\";\nimport { ChatEmitter } from \"./utils/eventEmitter\";\nimport { extractUrlFromString, fetchMetaData } from \"./utils/helpers\";\nimport { ALL_PATERNS_SHAPES, HASHTAG_PATTERN_SHAPE, LoadAllPaternShapes, loadParsedText, MENTION_PATTERN_SHAPE, URL_PATTERN_SHAPE } from \"./utils/patterns\";\nimport { ContextMenuWrapper } from \"./wrappers/ContextMenuWrapper\";\nvar ParsedText = loadParsedText();\n\nfunction _ChatBubble(props) {\n  var _propsContext$bubbleP7, _propsContext$bubbleP8, _propsContext$bubbleP18, _propsContext$bubbleP19, _propsContext$bubbleP20, _propsContext$pattern3, _propsContext$pattern4, _propsContext$bubbleP33, _propsContext$bubbleP34, _propsContext$bubbleP35, _propsContext$bubbleP36, _propsContext$bubbleP37, _propsContext$bubbleP38, _propsContext$bubbleP39, _propsContext$bubbleP40, _propsContext$bubbleP43, _propsContext$bubbleP45, _propsContext$listPro7, _propsContext$listPro8, _propsContext$bubbleP46, _propsContext$bubbleP47, _propsContext$bubbleP48, _message$user$avatar, _propsContext$bubbleP49, _message$repliedTo, _propsContext$bubbleP50, _propsContext$bubbleP51, _message$me2, _propsContext$bubbleP52, _propsContext$bubbleP53, _message$me3, _propsContext$bubbleP54, _propsContext$bubbleP55, _message$user$avatar2, _propsContext$bubbleP56;\n\n  var message = props.message,\n      children = props.children;\n  var propsContext = useContext(PropsContext);\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      mediaLoaded = _useState2[0],\n      setMediaLoaded = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      showMedia = _useState4[0],\n      setShowMedia = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      showUrlPreview = _useState6[0],\n      setShowUrlPreview = _useState6[1];\n\n  var _useState7 = useState(),\n      _useState8 = _slicedToArray(_useState7, 2),\n      urlPreviewData = _useState8[0],\n      setUrlPreviewData = _useState8[1];\n\n  var createdAt = useMemo(function () {\n    return message && dayjs(message.createdAt).format('HH:mm');\n  }, [message]);\n  var avatarSize = useMemo(function () {\n    var _propsContext$bubbleP, _propsContext$bubbleP2, _propsContext$bubbleP3, _propsContext$bubbleP4, _propsContext$bubbleP5, _propsContext$bubbleP6;\n\n    return {\n      width: ((_propsContext$bubbleP = propsContext.bubbleProps) === null || _propsContext$bubbleP === void 0 ? void 0 : (_propsContext$bubbleP2 = _propsContext$bubbleP.showAvatars) === null || _propsContext$bubbleP2 === void 0 ? void 0 : _propsContext$bubbleP2.width) || 40,\n      height: ((_propsContext$bubbleP3 = propsContext.bubbleProps) === null || _propsContext$bubbleP3 === void 0 ? void 0 : (_propsContext$bubbleP4 = _propsContext$bubbleP3.showAvatars) === null || _propsContext$bubbleP4 === void 0 ? void 0 : _propsContext$bubbleP4.width) || 40,\n      borderRadius: ((_propsContext$bubbleP5 = propsContext.bubbleProps) === null || _propsContext$bubbleP5 === void 0 ? void 0 : (_propsContext$bubbleP6 = _propsContext$bubbleP5.showAvatars) === null || _propsContext$bubbleP6 === void 0 ? void 0 : _propsContext$bubbleP6.width) || 40\n    };\n  }, [(_propsContext$bubbleP7 = propsContext.bubbleProps) === null || _propsContext$bubbleP7 === void 0 ? void 0 : (_propsContext$bubbleP8 = _propsContext$bubbleP7.showAvatars) === null || _propsContext$bubbleP8 === void 0 ? void 0 : _propsContext$bubbleP8.width]);\n  var bubbleBackgroundColor = useMemo(function () {\n    var _propsContext$bubbleP9, _propsContext$bubbleP16, _propsContext$bubbleP17;\n\n    if ((_propsContext$bubbleP9 = propsContext.bubbleProps) !== null && _propsContext$bubbleP9 !== void 0 && _propsContext$bubbleP9.containerStyle) {\n      if (message !== null && message !== void 0 && message.me) {\n        var _propsContext$bubbleP10, _propsContext$bubbleP11;\n\n        return _objectSpread({\n          backgroundColor: (_propsContext$bubbleP10 = propsContext === null || propsContext === void 0 ? void 0 : (_propsContext$bubbleP11 = propsContext.bubbleProps) === null || _propsContext$bubbleP11 === void 0 ? void 0 : _propsContext$bubbleP11.selfBubbleColor) !== null && _propsContext$bubbleP10 !== void 0 ? _propsContext$bubbleP10 : '#afddfa'\n        }, propsContext.bubbleProps.containerStyle);\n      } else {\n        var _propsContext$bubbleP12, _propsContext$bubbleP13;\n\n        return _objectSpread({\n          backgroundColor: (_propsContext$bubbleP12 = propsContext === null || propsContext === void 0 ? void 0 : (_propsContext$bubbleP13 = propsContext.bubbleProps) === null || _propsContext$bubbleP13 === void 0 ? void 0 : _propsContext$bubbleP13.otherBubbleColor) !== null && _propsContext$bubbleP12 !== void 0 ? _propsContext$bubbleP12 : '#c8faaf'\n        }, propsContext.bubbleProps.containerStyle);\n      }\n    }\n\n    if (message !== null && message !== void 0 && message.me) {\n      var _propsContext$bubbleP14, _propsContext$bubbleP15;\n\n      return {\n        backgroundColor: (_propsContext$bubbleP14 = propsContext === null || propsContext === void 0 ? void 0 : (_propsContext$bubbleP15 = propsContext.bubbleProps) === null || _propsContext$bubbleP15 === void 0 ? void 0 : _propsContext$bubbleP15.selfBubbleColor) !== null && _propsContext$bubbleP14 !== void 0 ? _propsContext$bubbleP14 : '#afddfa'\n      };\n    }\n\n    return {\n      backgroundColor: (_propsContext$bubbleP16 = propsContext === null || propsContext === void 0 ? void 0 : (_propsContext$bubbleP17 = propsContext.bubbleProps) === null || _propsContext$bubbleP17 === void 0 ? void 0 : _propsContext$bubbleP17.otherBubbleColor) !== null && _propsContext$bubbleP16 !== void 0 ? _propsContext$bubbleP16 : '#c8faaf'\n    };\n  }, [message === null || message === void 0 ? void 0 : message.me, propsContext === null || propsContext === void 0 ? void 0 : (_propsContext$bubbleP18 = propsContext.bubbleProps) === null || _propsContext$bubbleP18 === void 0 ? void 0 : _propsContext$bubbleP18.otherBubbleColor, propsContext === null || propsContext === void 0 ? void 0 : (_propsContext$bubbleP19 = propsContext.bubbleProps) === null || _propsContext$bubbleP19 === void 0 ? void 0 : _propsContext$bubbleP19.selfBubbleColor, (_propsContext$bubbleP20 = propsContext.bubbleProps) === null || _propsContext$bubbleP20 === void 0 ? void 0 : _propsContext$bubbleP20.containerStyle]);\n  var bubbleAlignment = useMemo(function () {\n    if (message !== null && message !== void 0 && message.me) {\n      return {\n        alignSelf: 'flex-end'\n      };\n    }\n\n    return {\n      alignSelf: 'flex-start'\n    };\n  }, [message === null || message === void 0 ? void 0 : message.me]);\n  useEffect(function () {\n    if (message !== null && message !== void 0 && message.media) {\n      message.media.forEach(function (media) {\n        if (media.type === MediaType.Image) {\n          InteractionManager.runAfterInteractions(function () {\n            Image.prefetch(media.uri).then(function () {\n              setMediaLoaded(true);\n            });\n          });\n        }\n      });\n    }\n\n    if (propsContext.enableUrlPreviews) {\n      InteractionManager.runAfterInteractions(function _callee() {\n        var _message$text, url, data;\n\n        return _regeneratorRuntime.async(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                url = extractUrlFromString((_message$text = message === null || message === void 0 ? void 0 : message.text) !== null && _message$text !== void 0 ? _message$text : '');\n\n                if (!url) {\n                  _context.next = 6;\n                  break;\n                }\n\n                _context.next = 4;\n                return _regeneratorRuntime.awrap(fetchMetaData(url));\n\n              case 4:\n                data = _context.sent;\n\n                if (data) {\n                  setShowUrlPreview(true);\n                  setUrlPreviewData(data);\n                }\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, null, null, null, Promise);\n      });\n    }\n  }, [message === null || message === void 0 ? void 0 : message.media, message === null || message === void 0 ? void 0 : message.text, propsContext.enableUrlPreviews]);\n  var onPressPattern = useCallback(function (pattern, index) {\n    if (!message) return;\n    ChatEmitter === null || ChatEmitter === void 0 ? void 0 : ChatEmitter.emit('patternPressed', pattern, index, message);\n  }, [message]);\n  var messagePatterns = useMemo(function () {\n    var _propsContext$pattern, _propsContext$pattern2;\n\n    var patterns = [];\n    if (!(propsContext !== null && propsContext !== void 0 && propsContext.enablePatterns)) return;\n    if (!ParsedText) return;\n    LoadAllPaternShapes(onPressPattern);\n\n    if ((_propsContext$pattern = propsContext.patternProps) !== null && _propsContext$pattern !== void 0 && _propsContext$pattern.customPatterns) {\n      patterns.push.apply(patterns, _toConsumableArray(propsContext.patternProps.customPatterns));\n    }\n\n    if (propsContext !== null && propsContext !== void 0 && (_propsContext$pattern2 = propsContext.patternProps) !== null && _propsContext$pattern2 !== void 0 && _propsContext$pattern2.allowPatterns) {\n      propsContext.patternProps.allowPatterns.forEach(function (pattern) {\n        switch (pattern) {\n          case 'hashtag':\n            patterns.push(HASHTAG_PATTERN_SHAPE);\n            break;\n\n          case 'mention':\n            patterns.push(MENTION_PATTERN_SHAPE);\n            break;\n\n          case 'url':\n            patterns.push(URL_PATTERN_SHAPE);\n            break;\n        }\n      });\n    } else {\n      ALL_PATERNS_SHAPES.forEach(function (pattern) {\n        return patterns.push(pattern);\n      });\n    }\n\n    return patterns;\n  }, [onPressPattern, propsContext === null || propsContext === void 0 ? void 0 : propsContext.enablePatterns, propsContext === null || propsContext === void 0 ? void 0 : (_propsContext$pattern3 = propsContext.patternProps) === null || _propsContext$pattern3 === void 0 ? void 0 : _propsContext$pattern3.allowPatterns, propsContext === null || propsContext === void 0 ? void 0 : (_propsContext$pattern4 = propsContext.patternProps) === null || _propsContext$pattern4 === void 0 ? void 0 : _propsContext$pattern4.customPatterns]);\n  var renderTicks = useCallback(function () {\n    var _propsContext$bubbleP21, _propsContext$bubbleP22, _propsContext$bubbleP23, _propsContext$bubbleP24, _propsContext$bubbleP25, _propsContext$bubbleP26, _propsContext$bubbleP27, _propsContext$bubbleP28, _propsContext$bubbleP29, _propsContext$bubbleP30, _propsContext$bubbleP31, _propsContext$bubbleP32;\n\n    if (message !== null && message !== void 0 && message.status) {\n      switch (message.status) {\n        case MessageStatus.Sending:\n          return (_propsContext$bubbleP21 = (_propsContext$bubbleP22 = propsContext.bubbleProps) === null || _propsContext$bubbleP22 === void 0 ? void 0 : (_propsContext$bubbleP23 = _propsContext$bubbleP22.tickProps) === null || _propsContext$bubbleP23 === void 0 ? void 0 : _propsContext$bubbleP23.sendingElement) !== null && _propsContext$bubbleP21 !== void 0 ? _propsContext$bubbleP21 : React.createElement(Text, null, \"\\uD83D\\uDD04\");\n\n        case MessageStatus.Sent:\n          return (_propsContext$bubbleP24 = (_propsContext$bubbleP25 = propsContext.bubbleProps) === null || _propsContext$bubbleP25 === void 0 ? void 0 : (_propsContext$bubbleP26 = _propsContext$bubbleP25.tickProps) === null || _propsContext$bubbleP26 === void 0 ? void 0 : _propsContext$bubbleP26.sentElement) !== null && _propsContext$bubbleP24 !== void 0 ? _propsContext$bubbleP24 : React.createElement(Text, null, \"\\u2714\");\n\n        case MessageStatus.Delivered:\n          return (_propsContext$bubbleP27 = (_propsContext$bubbleP28 = propsContext.bubbleProps) === null || _propsContext$bubbleP28 === void 0 ? void 0 : (_propsContext$bubbleP29 = _propsContext$bubbleP28.tickProps) === null || _propsContext$bubbleP29 === void 0 ? void 0 : _propsContext$bubbleP29.deliveredElement) !== null && _propsContext$bubbleP27 !== void 0 ? _propsContext$bubbleP27 : React.createElement(Text, null, \"\\u2611\");\n\n        case MessageStatus.Read:\n          return (_propsContext$bubbleP30 = (_propsContext$bubbleP31 = propsContext.bubbleProps) === null || _propsContext$bubbleP31 === void 0 ? void 0 : (_propsContext$bubbleP32 = _propsContext$bubbleP31.tickProps) === null || _propsContext$bubbleP32 === void 0 ? void 0 : _propsContext$bubbleP32.readElement) !== null && _propsContext$bubbleP30 !== void 0 ? _propsContext$bubbleP30 : React.createElement(Text, null, \"\\u2705\");\n      }\n    }\n\n    return null;\n  }, [message === null || message === void 0 ? void 0 : message.status, (_propsContext$bubbleP33 = propsContext.bubbleProps) === null || _propsContext$bubbleP33 === void 0 ? void 0 : (_propsContext$bubbleP34 = _propsContext$bubbleP33.tickProps) === null || _propsContext$bubbleP34 === void 0 ? void 0 : _propsContext$bubbleP34.deliveredElement, (_propsContext$bubbleP35 = propsContext.bubbleProps) === null || _propsContext$bubbleP35 === void 0 ? void 0 : (_propsContext$bubbleP36 = _propsContext$bubbleP35.tickProps) === null || _propsContext$bubbleP36 === void 0 ? void 0 : _propsContext$bubbleP36.readElement, (_propsContext$bubbleP37 = propsContext.bubbleProps) === null || _propsContext$bubbleP37 === void 0 ? void 0 : (_propsContext$bubbleP38 = _propsContext$bubbleP37.tickProps) === null || _propsContext$bubbleP38 === void 0 ? void 0 : _propsContext$bubbleP38.sendingElement, (_propsContext$bubbleP39 = propsContext.bubbleProps) === null || _propsContext$bubbleP39 === void 0 ? void 0 : (_propsContext$bubbleP40 = _propsContext$bubbleP39.tickProps) === null || _propsContext$bubbleP40 === void 0 ? void 0 : _propsContext$bubbleP40.sentElement]);\n  var renderFooter = useCallback(function () {\n    var _propsContext$bubbleP41, _propsContext$bubbleP42, _message$me;\n\n    return React.createElement(View, {\n      style: styles.bubbleFooter\n    }, React.createElement(Text, {\n      style: [styles.date, (propsContext === null || propsContext === void 0 ? void 0 : (_propsContext$bubbleP41 = propsContext.bubbleProps) === null || _propsContext$bubbleP41 === void 0 ? void 0 : _propsContext$bubbleP41.dateStyle) && (propsContext === null || propsContext === void 0 ? void 0 : (_propsContext$bubbleP42 = propsContext.bubbleProps) === null || _propsContext$bubbleP42 === void 0 ? void 0 : _propsContext$bubbleP42.dateStyle((_message$me = message === null || message === void 0 ? void 0 : message.me) !== null && _message$me !== void 0 ? _message$me : false))]\n    }, createdAt), renderTicks());\n  }, [createdAt, message === null || message === void 0 ? void 0 : message.me, propsContext === null || propsContext === void 0 ? void 0 : (_propsContext$bubbleP43 = propsContext.bubbleProps) === null || _propsContext$bubbleP43 === void 0 ? void 0 : _propsContext$bubbleP43.dateStyle, renderTicks]);\n  var renderCornerRounding = useCallback(function () {\n    var _propsContext$bubbleP44;\n\n    if (((_propsContext$bubbleP44 = propsContext.bubbleProps) === null || _propsContext$bubbleP44 === void 0 ? void 0 : _propsContext$bubbleP44.enableCornerRounding) === false) return null;\n\n    if (message !== null && message !== void 0 && message.me) {\n      var _propsContext$listPro, _propsContext$listPro2, _propsContext$listPro3;\n\n      return React.createElement(React.Fragment, null, React.createElement(View, {\n        style: [styles.rightArrow, bubbleBackgroundColor]\n      }), React.createElement(View, {\n        style: [styles.rightArrowOverlap, {\n          backgroundColor: (_propsContext$listPro = (_propsContext$listPro2 = propsContext.listProps) === null || _propsContext$listPro2 === void 0 ? void 0 : (_propsContext$listPro3 = _propsContext$listPro2.containerStyle) === null || _propsContext$listPro3 === void 0 ? void 0 : _propsContext$listPro3.backgroundColor) !== null && _propsContext$listPro !== void 0 ? _propsContext$listPro : '#fff'\n        }]\n      }));\n    } else {\n      var _propsContext$listPro4, _propsContext$listPro5, _propsContext$listPro6;\n\n      return React.createElement(React.Fragment, null, React.createElement(View, {\n        style: [styles.leftArrow, bubbleBackgroundColor]\n      }), React.createElement(View, {\n        style: [styles.leftArrowOverlap, {\n          backgroundColor: (_propsContext$listPro4 = (_propsContext$listPro5 = propsContext.listProps) === null || _propsContext$listPro5 === void 0 ? void 0 : (_propsContext$listPro6 = _propsContext$listPro5.containerStyle) === null || _propsContext$listPro6 === void 0 ? void 0 : _propsContext$listPro6.backgroundColor) !== null && _propsContext$listPro4 !== void 0 ? _propsContext$listPro4 : '#fff'\n        }]\n      }));\n    }\n  }, [bubbleBackgroundColor, message === null || message === void 0 ? void 0 : message.me, (_propsContext$bubbleP45 = propsContext.bubbleProps) === null || _propsContext$bubbleP45 === void 0 ? void 0 : _propsContext$bubbleP45.enableCornerRounding, (_propsContext$listPro7 = propsContext.listProps) === null || _propsContext$listPro7 === void 0 ? void 0 : (_propsContext$listPro8 = _propsContext$listPro7.containerStyle) === null || _propsContext$listPro8 === void 0 ? void 0 : _propsContext$listPro8.backgroundColor]);\n  var renderMedia = useCallback(function () {\n    if (message !== null && message !== void 0 && message.media) {\n      var _message$media$;\n\n      var photoViewCompatible = [];\n      message.media.forEach(function (media) {\n        if (media.type === MediaType.Image) {\n          photoViewCompatible.push({\n            type: 'image',\n            source: {\n              uri: media.uri\n            }\n          });\n        }\n\n        if (media.type === MediaType.Video) {\n          photoViewCompatible.push({\n            type: 'view',\n            children: React.createElement(VideoThumbnail, {\n              media: media,\n              isSelected: true\n            })\n          });\n          photoViewCompatible.push({\n            type: 'view',\n            children: React.createElement(VideoThumbnail, {\n              media: media,\n              isSelected: true\n            })\n          });\n        }\n      });\n      return React.createElement(View, {\n        style: {\n          flexDirection: 'row',\n          flexWrap: 'wrap'\n        }\n      }, message === null || message === void 0 ? void 0 : message.media.map(function (media, index) {\n        if (index < 3) {\n          return React.createElement(TouchableOpacity, {\n            onPress: function onPress() {\n              return setShowMedia(true);\n            }\n          }, media.type === MediaType.Image && mediaLoaded && React.createElement(View, null, React.createElement(Image, {\n            source: {\n              uri: media.uri\n            },\n            style: styles.media\n          })), media.type === MediaType.Video && React.createElement(VideoThumbnail, {\n            media: media\n          }));\n        }\n\n        return null;\n      }), message.media.length > 3 && React.createElement(TouchableOpacity, {\n        onPress: function onPress() {\n          return setShowMedia(true);\n        }\n      }, React.createElement(ImageBackground, {\n        style: styles.media,\n        source: {\n          uri: (_message$media$ = message.media[3]) === null || _message$media$ === void 0 ? void 0 : _message$media$.uri\n        },\n        imageStyle: {\n          borderRadius: 15\n        }\n      }, React.createElement(View, {\n        style: styles.backgroundOverlay\n      }, React.createElement(Text, {\n        style: {\n          color: '#fff',\n          textAlign: 'center',\n          fontSize: 20\n        }\n      }, \"+ \", message.media.length - 3)))), showMedia && React.createElement(PhotoView, {\n        views: photoViewCompatible,\n        visible: showMedia,\n        onRequestClose: function onRequestClose() {\n          return setShowMedia(false);\n        }\n      }));\n    }\n\n    return null;\n  }, [mediaLoaded, message, showMedia]);\n  var renderUrlPreview = useMemo(function () {\n    if (showUrlPreview && urlPreviewData && !(message !== null && message !== void 0 && message.repliedTo)) {\n      return React.createElement(View, {\n        style: {\n          marginTop: 10\n        }\n      }, React.createElement(UrlPreviewBubble, {\n        title: urlPreviewData.title,\n        description: urlPreviewData.description,\n        image: urlPreviewData.image,\n        url: urlPreviewData.url\n      }));\n    }\n\n    return null;\n  }, [message === null || message === void 0 ? void 0 : message.repliedTo, showUrlPreview, urlPreviewData]);\n  return React.createElement(View, {\n    style: [styles.wrapper, bubbleAlignment]\n  }, ((_propsContext$bubbleP46 = propsContext.bubbleProps) === null || _propsContext$bubbleP46 === void 0 ? void 0 : _propsContext$bubbleP46.trailingAccessory) && (message === null || message === void 0 ? void 0 : message.me) && React.createElement(View, null, propsContext.bubbleProps.trailingAccessory), ((_propsContext$bubbleP47 = propsContext.bubbleProps) === null || _propsContext$bubbleP47 === void 0 ? void 0 : (_propsContext$bubbleP48 = _propsContext$bubbleP47.showAvatars) === null || _propsContext$bubbleP48 === void 0 ? void 0 : _propsContext$bubbleP48.visible) && !(message !== null && message !== void 0 && message.me) && React.createElement(Image, {\n    source: (_message$user$avatar = message === null || message === void 0 ? void 0 : message.user.avatar) !== null && _message$user$avatar !== void 0 ? _message$user$avatar : require(\"./assets/images/noavatar.png\"),\n    style: [styles.avatar, avatarSize]\n  }), React.createElement(ContextMenuWrapper, {\n    message: message\n  }, React.createElement(View, {\n    style: [bubbleBackgroundColor, styles.container, (_propsContext$bubbleP49 = propsContext.bubbleProps) === null || _propsContext$bubbleP49 === void 0 ? void 0 : _propsContext$bubbleP49.containerStyle, {\n      padding: message !== null && message !== void 0 && message.repliedTo ? 5 : 15\n    }]\n  }, children ? children : React.createElement(React.Fragment, null, (message === null || message === void 0 ? void 0 : message.repliedTo) && React.createElement(ReplyingTo, {\n    username: message === null || message === void 0 ? void 0 : (_message$repliedTo = message.repliedTo) === null || _message$repliedTo === void 0 ? void 0 : _message$repliedTo.user.username,\n    text: message === null || message === void 0 ? void 0 : message.repliedTo.text,\n    messageId: message === null || message === void 0 ? void 0 : message.repliedTo.id\n  }), propsContext !== null && propsContext !== void 0 && propsContext.enablePatterns && ParsedText ? React.createElement(React.Fragment, null, renderMedia(), React.createElement(ParsedText, {\n    parse: messagePatterns,\n    style: (propsContext === null || propsContext === void 0 ? void 0 : (_propsContext$bubbleP50 = propsContext.bubbleProps) === null || _propsContext$bubbleP50 === void 0 ? void 0 : _propsContext$bubbleP50.labelStyle) && ((_propsContext$bubbleP51 = propsContext.bubbleProps) === null || _propsContext$bubbleP51 === void 0 ? void 0 : _propsContext$bubbleP51.labelStyle((_message$me2 = message === null || message === void 0 ? void 0 : message.me) !== null && _message$me2 !== void 0 ? _message$me2 : false))\n  }, message === null || message === void 0 ? void 0 : message.text), renderUrlPreview, renderFooter()) : React.createElement(View, null, renderMedia(), React.createElement(Text, {\n    style: (propsContext === null || propsContext === void 0 ? void 0 : (_propsContext$bubbleP52 = propsContext.bubbleProps) === null || _propsContext$bubbleP52 === void 0 ? void 0 : _propsContext$bubbleP52.labelStyle) && ((_propsContext$bubbleP53 = propsContext.bubbleProps) === null || _propsContext$bubbleP53 === void 0 ? void 0 : _propsContext$bubbleP53.labelStyle((_message$me3 = message === null || message === void 0 ? void 0 : message.me) !== null && _message$me3 !== void 0 ? _message$me3 : false))\n  }, message === null || message === void 0 ? void 0 : message.text), renderUrlPreview, renderFooter())), renderCornerRounding())), ((_propsContext$bubbleP54 = propsContext.bubbleProps) === null || _propsContext$bubbleP54 === void 0 ? void 0 : (_propsContext$bubbleP55 = _propsContext$bubbleP54.showAvatars) === null || _propsContext$bubbleP55 === void 0 ? void 0 : _propsContext$bubbleP55.visible) && (message === null || message === void 0 ? void 0 : message.me) && React.createElement(Image, {\n    source: (_message$user$avatar2 = message === null || message === void 0 ? void 0 : message.user.avatar) !== null && _message$user$avatar2 !== void 0 ? _message$user$avatar2 : require(\"./assets/images/noavatar.png\"),\n    style: [styles.avatarMe, avatarSize]\n  }), ((_propsContext$bubbleP56 = propsContext.bubbleProps) === null || _propsContext$bubbleP56 === void 0 ? void 0 : _propsContext$bubbleP56.trailingAccessory) && !(message !== null && message !== void 0 && message.me) && React.createElement(View, null, propsContext.bubbleProps.trailingAccessory));\n}\n\nexport var ChatBubble = React.memo(_ChatBubble);\nexport var styles = StyleSheet.create({\n  wrapper: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between'\n  },\n  container: {\n    margin: 20,\n    maxWidth: Dimensions.get('screen').width - 120,\n    borderRadius: 10\n  },\n  rightArrow: {\n    position: 'absolute',\n    width: 20,\n    height: 25,\n    bottom: 0,\n    borderBottomLeftRadius: 25,\n    right: -7\n  },\n  rightArrowOverlap: {\n    position: 'absolute',\n    width: 20,\n    height: 35,\n    bottom: -6,\n    borderBottomLeftRadius: 18,\n    right: -20\n  },\n  leftArrow: {\n    position: 'absolute',\n    width: 20,\n    height: 25,\n    bottom: 0,\n    borderBottomRightRadius: 25,\n    left: -10\n  },\n  leftArrowOverlap: {\n    position: 'absolute',\n    width: 20,\n    height: 35,\n    bottom: -6,\n    borderBottomRightRadius: 18,\n    left: -20\n  },\n  date: {\n    color: '#a8a8a8',\n    fontSize: 11\n  },\n  avatar: {\n    marginLeft: 10\n  },\n  avatarMe: {\n    marginRight: 10\n  },\n  bubbleFooter: {\n    justifyContent: 'flex-end',\n    flexDirection: 'row',\n    marginTop: 5\n  },\n  moreMedia: {\n    width: 100,\n    height: 100,\n    borderWidth: 1,\n    borderStyle: 'dashed',\n    borderRadius: 15,\n    justifyContent: 'center',\n    alignItems: 'center',\n    borderColor: '#ccc'\n  },\n  media: {\n    width: 110,\n    height: 100,\n    borderRadius: 15,\n    marginRight: 10,\n    marginBottom: 10\n  },\n  backgroundOverlay: {\n    width: 110,\n    height: 100,\n    backgroundColor: 'rgba(0,0,0,0.6)',\n    borderRadius: 15,\n    justifyContent: 'center',\n    alignContent: 'center',\n    alignItems: 'center'\n  }\n});","map":{"version":3,"mappings":"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","names":["dayjs","React","useCallback","useContext","useEffect","useMemo","useState","PropsContext","PhotoView","ReplyingTo","UrlPreviewBubble","VideoThumbnail","MediaType","MessageStatus","ChatEmitter","extractUrlFromString","fetchMetaData","ALL_PATERNS_SHAPES","HASHTAG_PATTERN_SHAPE","LoadAllPaternShapes","loadParsedText","MENTION_PATTERN_SHAPE","URL_PATTERN_SHAPE","ContextMenuWrapper","ParsedText","_ChatBubble","props","message","children","propsContext","mediaLoaded","setMediaLoaded","showMedia","setShowMedia","showUrlPreview","setShowUrlPreview","urlPreviewData","setUrlPreviewData","createdAt","format","avatarSize","width","bubbleProps","showAvatars","height","borderRadius","_propsContext$bubbleP7","_propsContext$bubbleP8","bubbleBackgroundColor","_propsContext$bubbleP9","containerStyle","me","backgroundColor","_propsContext$bubbleP11","selfBubbleColor","_propsContext$bubbleP13","otherBubbleColor","_propsContext$bubbleP15","_propsContext$bubbleP17","_propsContext$bubbleP18","_propsContext$bubbleP19","_propsContext$bubbleP20","bubbleAlignment","alignSelf","media","forEach","type","Image","InteractionManager","runAfterInteractions","prefetch","uri","then","enableUrlPreviews","url","text","data","onPressPattern","pattern","index","emit","messagePatterns","patterns","enablePatterns","patternProps","_propsContext$pattern","customPatterns","push","_propsContext$pattern2","allowPatterns","_propsContext$pattern3","_propsContext$pattern4","renderTicks","status","Sending","_propsContext$bubbleP22","tickProps","_propsContext$bubbleP23","sendingElement","Text","Sent","_propsContext$bubbleP25","_propsContext$bubbleP26","sentElement","Delivered","_propsContext$bubbleP28","_propsContext$bubbleP29","deliveredElement","Read","_propsContext$bubbleP31","_propsContext$bubbleP32","readElement","_propsContext$bubbleP33","_propsContext$bubbleP34","_propsContext$bubbleP35","_propsContext$bubbleP36","_propsContext$bubbleP37","_propsContext$bubbleP38","_propsContext$bubbleP39","_propsContext$bubbleP40","renderFooter","View","style","styles","bubbleFooter","date","dateStyle","_propsContext$bubbleP42","_propsContext$bubbleP43","renderCornerRounding","enableCornerRounding","rightArrow","rightArrowOverlap","listProps","_propsContext$listPro2","_propsContext$listPro3","leftArrow","leftArrowOverlap","_propsContext$listPro5","_propsContext$listPro6","_propsContext$bubbleP45","_propsContext$listPro7","_propsContext$listPro8","renderMedia","photoViewCompatible","source","Video","isSelected","flexDirection","flexWrap","map","TouchableOpacity","onPress","length","ImageBackground","_message$media$","imageStyle","backgroundOverlay","color","textAlign","fontSize","views","visible","onRequestClose","renderUrlPreview","repliedTo","marginTop","title","description","image","wrapper","trailingAccessory","user","avatar","require","container","_propsContext$bubbleP49","padding","username","_message$repliedTo","messageId","id","parse","labelStyle","_propsContext$bubbleP51","_propsContext$bubbleP53","avatarMe","ChatBubble","memo","StyleSheet","create","alignItems","justifyContent","margin","maxWidth","Dimensions","get","position","bottom","borderBottomLeftRadius","right","borderBottomRightRadius","left","marginLeft","marginRight","moreMedia","borderWidth","borderStyle","borderColor","marginBottom","alignContent"],"sources":["ChatBubble.tsx"],"sourcesContent":["import type { ViewSource } from '@muhammedkpln/react-native-image-viewing/dist/ImageViewing';\nimport dayjs from 'dayjs';\nimport React, {\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\nimport {\n  Dimensions,\n  Image,\n  ImageBackground,\n  InteractionManager,\n  StyleSheet,\n  Text,\n  TouchableOpacity,\n  View,\n  ViewStyle,\n} from 'react-native';\nimport { PropsContext } from './Chatty';\nimport { PhotoView } from './components/PhotoView';\nimport { ReplyingTo } from './components/ReplyingTo';\nimport { UrlPreviewBubble } from './components/UrlPreviewBubble';\nimport { VideoThumbnail } from './components/VideoThumbnail';\nimport {\n  IChatBubble,\n  IMessage,\n  IUrlPreviewBubble,\n  MediaType,\n  MessageStatus,\n} from './types/Chatty.types';\nimport { ChatEmitter } from './utils/eventEmitter';\nimport { extractUrlFromString, fetchMetaData } from './utils/helpers';\nimport {\n  ALL_PATERNS_SHAPES,\n  HASHTAG_PATTERN_SHAPE,\n  LoadAllPaternShapes,\n  loadParsedText,\n  MENTION_PATTERN_SHAPE,\n  URL_PATTERN_SHAPE,\n} from './utils/patterns';\nimport { ContextMenuWrapper } from './wrappers/ContextMenuWrapper';\n\nconst ParsedText = loadParsedText();\n\nfunction _ChatBubble(props: IChatBubble) {\n  const { message, children } = props;\n  const propsContext = useContext(PropsContext);\n  const [mediaLoaded, setMediaLoaded] = useState<boolean>(false);\n  const [showMedia, setShowMedia] = useState<boolean>(false);\n  const [showUrlPreview, setShowUrlPreview] = useState(false);\n  const [urlPreviewData, setUrlPreviewData] = useState<IUrlPreviewBubble>();\n  const createdAt = useMemo(() => {\n    return message && dayjs(message.createdAt).format('HH:mm');\n  }, [message]);\n\n  const avatarSize = useMemo(() => {\n    return {\n      width: propsContext.bubbleProps?.showAvatars?.width || 40,\n      height: propsContext.bubbleProps?.showAvatars?.width || 40,\n      borderRadius: propsContext.bubbleProps?.showAvatars?.width || 40,\n    };\n  }, [propsContext.bubbleProps?.showAvatars?.width]);\n\n  const bubbleBackgroundColor = useMemo<ViewStyle>(() => {\n    if (propsContext.bubbleProps?.containerStyle) {\n      if (message?.me) {\n        return {\n          backgroundColor:\n            propsContext?.bubbleProps?.selfBubbleColor ?? '#afddfa',\n          ...propsContext.bubbleProps.containerStyle,\n        };\n      } else {\n        return {\n          backgroundColor:\n            propsContext?.bubbleProps?.otherBubbleColor ?? '#c8faaf',\n\n          ...propsContext.bubbleProps.containerStyle,\n        };\n      }\n    }\n\n    if (message?.me) {\n      return {\n        backgroundColor:\n          propsContext?.bubbleProps?.selfBubbleColor ?? '#afddfa',\n      };\n    }\n\n    return {\n      backgroundColor: propsContext?.bubbleProps?.otherBubbleColor ?? '#c8faaf',\n    };\n  }, [\n    message?.me,\n    propsContext?.bubbleProps?.otherBubbleColor,\n    propsContext?.bubbleProps?.selfBubbleColor,\n    propsContext.bubbleProps?.containerStyle,\n  ]);\n\n  const bubbleAlignment = useMemo<ViewStyle>(() => {\n    if (message?.me) {\n      return {\n        alignSelf: 'flex-end',\n      };\n    }\n\n    return {\n      alignSelf: 'flex-start',\n    };\n  }, [message?.me]);\n\n  useEffect(() => {\n    if (message?.media) {\n      message.media.forEach((media) => {\n        if (media.type === MediaType.Image) {\n          InteractionManager.runAfterInteractions(() => {\n            Image.prefetch(media.uri).then(() => {\n              setMediaLoaded(true);\n            });\n          });\n        }\n      });\n    }\n\n    if (propsContext.enableUrlPreviews) {\n      InteractionManager.runAfterInteractions(async () => {\n        const url = extractUrlFromString(message?.text ?? '');\n\n        if (url) {\n          const data = await fetchMetaData(url);\n\n          if (data) {\n            setShowUrlPreview(true);\n            setUrlPreviewData(data);\n          }\n        }\n      });\n    }\n  }, [message?.media, message?.text, propsContext.enableUrlPreviews]);\n\n  const onPressPattern = useCallback(\n    (pattern: string, index: number) => {\n      if (!message) return;\n      ChatEmitter?.emit('patternPressed', pattern, index, message);\n    },\n    [message]\n  );\n\n  const messagePatterns = useMemo(() => {\n    const patterns: any[] = [];\n\n    if (!propsContext?.enablePatterns) return;\n    if (!ParsedText) return;\n\n    LoadAllPaternShapes(onPressPattern);\n\n    if (propsContext.patternProps?.customPatterns) {\n      patterns.push(...propsContext.patternProps.customPatterns);\n    }\n\n    if (propsContext?.patternProps?.allowPatterns) {\n      propsContext.patternProps.allowPatterns.forEach((pattern) => {\n        switch (pattern) {\n          case 'hashtag':\n            patterns.push(HASHTAG_PATTERN_SHAPE);\n            break;\n          case 'mention':\n            patterns.push(MENTION_PATTERN_SHAPE);\n            break;\n          case 'url':\n            patterns.push(URL_PATTERN_SHAPE);\n            break;\n        }\n      });\n    } else {\n      ALL_PATERNS_SHAPES.forEach((pattern) => patterns.push(pattern));\n    }\n\n    return patterns;\n  }, [\n    onPressPattern,\n    propsContext?.enablePatterns,\n    propsContext?.patternProps?.allowPatterns,\n    propsContext?.patternProps?.customPatterns,\n  ]);\n\n  const renderTicks = useCallback(() => {\n    if (message?.status) {\n      switch (message.status) {\n        case MessageStatus.Sending:\n          return (\n            propsContext.bubbleProps?.tickProps?.sendingElement ?? (\n              <Text></Text>\n            )\n          );\n\n        case MessageStatus.Sent:\n          return (\n            propsContext.bubbleProps?.tickProps?.sentElement ?? <Text></Text>\n          );\n\n        case MessageStatus.Delivered:\n          return (\n            propsContext.bubbleProps?.tickProps?.deliveredElement ?? (\n              <Text></Text>\n            )\n          );\n\n        case MessageStatus.Read:\n          return (\n            propsContext.bubbleProps?.tickProps?.readElement ?? <Text></Text>\n          );\n      }\n    }\n\n    return null;\n  }, [\n    message?.status,\n    propsContext.bubbleProps?.tickProps?.deliveredElement,\n    propsContext.bubbleProps?.tickProps?.readElement,\n    propsContext.bubbleProps?.tickProps?.sendingElement,\n    propsContext.bubbleProps?.tickProps?.sentElement,\n  ]);\n\n  const renderFooter = useCallback(() => {\n    return (\n      <View style={styles.bubbleFooter}>\n        <Text\n          style={[\n            styles.date,\n            propsContext?.bubbleProps?.dateStyle &&\n              propsContext?.bubbleProps?.dateStyle!(message?.me ?? false),\n          ]}\n        >\n          {createdAt}\n        </Text>\n        {renderTicks()}\n      </View>\n    );\n  }, [\n    createdAt,\n    message?.me,\n    propsContext?.bubbleProps?.dateStyle,\n    renderTicks,\n  ]);\n\n  const renderCornerRounding = useCallback(() => {\n    if (propsContext.bubbleProps?.enableCornerRounding === false) return null;\n\n    if (message?.me) {\n      return (\n        <>\n          <View style={[styles.rightArrow, bubbleBackgroundColor]}></View>\n          <View\n            style={[\n              styles.rightArrowOverlap,\n              {\n                backgroundColor:\n                  propsContext.listProps?.containerStyle?.backgroundColor ??\n                  '#fff',\n              },\n            ]}\n          ></View>\n        </>\n      );\n    } else {\n      return (\n        <>\n          <View style={[styles.leftArrow, bubbleBackgroundColor]}></View>\n          <View\n            style={[\n              styles.leftArrowOverlap,\n              {\n                backgroundColor:\n                  propsContext.listProps?.containerStyle?.backgroundColor ??\n                  '#fff',\n              },\n            ]}\n          ></View>\n        </>\n      );\n    }\n  }, [\n    bubbleBackgroundColor,\n    message?.me,\n    propsContext.bubbleProps?.enableCornerRounding,\n    propsContext.listProps?.containerStyle?.backgroundColor,\n  ]);\n\n  const renderMedia = useCallback(() => {\n    if (message?.media) {\n      const photoViewCompatible: ViewSource[] = [];\n\n      message.media.forEach((media) => {\n        if (media.type === MediaType.Image) {\n          photoViewCompatible.push({\n            type: 'image',\n            source: {\n              uri: media.uri,\n            },\n          });\n        }\n\n        if (media.type === MediaType.Video) {\n          photoViewCompatible.push({\n            type: 'view',\n            children: <VideoThumbnail media={media} isSelected />,\n          });\n          photoViewCompatible.push({\n            type: 'view',\n            children: <VideoThumbnail media={media} isSelected />,\n          });\n        }\n      });\n\n      return (\n        <View style={{ flexDirection: 'row', flexWrap: 'wrap' }}>\n          {message?.media.map((media, index) => {\n            if (index < 3) {\n              return (\n                <TouchableOpacity onPress={() => setShowMedia(true)}>\n                  {media.type === MediaType.Image && mediaLoaded && (\n                    <View>\n                      <Image source={{ uri: media.uri }} style={styles.media} />\n                    </View>\n                  )}\n                  {media.type === MediaType.Video && (\n                    <VideoThumbnail media={media} />\n                  )}\n                </TouchableOpacity>\n              );\n            }\n\n            return null;\n          })}\n\n          {message.media.length > 3 && (\n            <TouchableOpacity onPress={() => setShowMedia(true)}>\n              <ImageBackground\n                style={styles.media}\n                source={{ uri: message.media[3]?.uri }}\n                imageStyle={{\n                  borderRadius: 15,\n                }}\n              >\n                <View style={styles.backgroundOverlay}>\n                  <Text\n                    style={{ color: '#fff', textAlign: 'center', fontSize: 20 }}\n                  >\n                    + {message.media.length - 3}\n                  </Text>\n                </View>\n              </ImageBackground>\n            </TouchableOpacity>\n          )}\n\n          {showMedia && (\n            <PhotoView\n              views={photoViewCompatible}\n              visible={showMedia}\n              onRequestClose={() => setShowMedia(false)}\n            />\n          )}\n        </View>\n      );\n    }\n\n    return null;\n  }, [mediaLoaded, message, showMedia]);\n\n  const renderUrlPreview = useMemo(() => {\n    if (showUrlPreview && urlPreviewData && !message?.repliedTo) {\n      return (\n        <View style={{ marginTop: 10 }}>\n          <UrlPreviewBubble\n            title={urlPreviewData.title}\n            description={urlPreviewData.description}\n            image={urlPreviewData.image}\n            url={urlPreviewData.url}\n          />\n        </View>\n      );\n    }\n\n    return null;\n  }, [message?.repliedTo, showUrlPreview, urlPreviewData]);\n\n  return (\n    <View style={[styles.wrapper, bubbleAlignment]}>\n      {propsContext.bubbleProps?.trailingAccessory && message?.me && (\n        <View>{propsContext.bubbleProps.trailingAccessory}</View>\n      )}\n\n      {propsContext.bubbleProps?.showAvatars?.visible && !message?.me && (\n        <Image\n          source={\n            message?.user.avatar ?? require('./assets/images/noavatar.png')\n          }\n          style={[styles.avatar, avatarSize]}\n        />\n      )}\n\n      <ContextMenuWrapper message={message as IMessage}>\n        <View\n          style={[\n            bubbleBackgroundColor,\n            styles.container,\n            propsContext.bubbleProps?.containerStyle,\n            { padding: message?.repliedTo ? 5 : 15 },\n          ]}\n        >\n          {children ? (\n            children\n          ) : (\n            <>\n              {message?.repliedTo && (\n                <ReplyingTo\n                  username={message?.repliedTo?.user.username}\n                  text={message?.repliedTo.text}\n                  messageId={message?.repliedTo.id}\n                />\n              )}\n\n              {propsContext?.enablePatterns && ParsedText ? (\n                <>\n                  {renderMedia()}\n\n                  <ParsedText\n                    parse={messagePatterns}\n                    style={\n                      propsContext?.bubbleProps?.labelStyle &&\n                      propsContext.bubbleProps?.labelStyle(message?.me ?? false)\n                    }\n                  >\n                    {message?.text}\n                  </ParsedText>\n                  {renderUrlPreview}\n                  {renderFooter()}\n                </>\n              ) : (\n                <View>\n                  {renderMedia()}\n\n                  <Text\n                    style={\n                      propsContext?.bubbleProps?.labelStyle &&\n                      propsContext.bubbleProps?.labelStyle(message?.me ?? false)\n                    }\n                  >\n                    {message?.text}\n                  </Text>\n                  {renderUrlPreview}\n                  {renderFooter()}\n                </View>\n              )}\n            </>\n          )}\n          {renderCornerRounding()}\n        </View>\n      </ContextMenuWrapper>\n\n      {propsContext.bubbleProps?.showAvatars?.visible && message?.me && (\n        <Image\n          source={\n            message?.user.avatar ?? require('./assets/images/noavatar.png')\n          }\n          style={[styles.avatarMe, avatarSize]}\n        />\n      )}\n\n      {propsContext.bubbleProps?.trailingAccessory && !message?.me && (\n        <View>{propsContext.bubbleProps.trailingAccessory}</View>\n      )}\n    </View>\n  );\n}\n\nexport const ChatBubble = React.memo(_ChatBubble);\n\nexport const styles = StyleSheet.create({\n  wrapper: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n  },\n  container: {\n    margin: 20,\n    maxWidth: Dimensions.get('screen').width - 120,\n    borderRadius: 10,\n  },\n  rightArrow: {\n    position: 'absolute',\n    width: 20,\n    height: 25,\n    bottom: 0,\n    borderBottomLeftRadius: 25,\n    right: -7,\n  },\n  rightArrowOverlap: {\n    position: 'absolute',\n    width: 20,\n    height: 35,\n    bottom: -6,\n    borderBottomLeftRadius: 18,\n    right: -20,\n  },\n  leftArrow: {\n    position: 'absolute',\n    width: 20,\n    height: 25,\n    bottom: 0,\n    borderBottomRightRadius: 25,\n    left: -10,\n  },\n\n  leftArrowOverlap: {\n    position: 'absolute',\n    width: 20,\n    height: 35,\n    bottom: -6,\n    borderBottomRightRadius: 18,\n    left: -20,\n  },\n  date: {\n    color: '#a8a8a8',\n    fontSize: 11,\n  },\n  avatar: {\n    marginLeft: 10,\n  },\n  avatarMe: {\n    marginRight: 10,\n  },\n  bubbleFooter: {\n    justifyContent: 'flex-end',\n    flexDirection: 'row',\n    marginTop: 5,\n  },\n  moreMedia: {\n    width: 100,\n    height: 100,\n    borderWidth: 1,\n    borderStyle: 'dashed',\n    borderRadius: 15,\n    justifyContent: 'center',\n    alignItems: 'center',\n    borderColor: '#ccc',\n  },\n  media: {\n    width: 110,\n    height: 100,\n    borderRadius: 15,\n    marginRight: 10,\n    marginBottom: 10,\n  },\n  backgroundOverlay: {\n    width: 110,\n    height: 100,\n    backgroundColor: 'rgba(0,0,0,0.6)',\n    borderRadius: 15,\n    justifyContent: 'center',\n    alignContent: 'center',\n    alignItems: 'center',\n  },\n});\n"]},"metadata":{},"sourceType":"module"}