{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport React, { useState, useContext, useEffect } from \"react\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { MaterialIcons, Ionicons, Entypo } from \"@expo/vector-icons\";\nimport { GroupContext } from \"../../context/GroupContext\";\nimport { FirebaseContext } from \"../../context/FirebaseContext\";\nimport { UserContext } from \"../../context/UserContext\";\nimport * as SecureStore from 'expo-secure-store';\nimport { SwipeListView } from \"react-native-swipe-list-view\";\nimport { Box, Text, Pressable, Heading, IconButton, Icon, HStack, Avatar, VStack, Spacer, Center, Image, Divider, Stack, Button } from \"native-base\";\nimport RefreshControl from \"react-native-web/dist/exports/RefreshControl\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default HomeScreen = function HomeScreen(_ref) {\n  var navigation = _ref.navigation;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      Groups = _useState2[0],\n      setGroups = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      data = _useState4[0],\n      setData = _useState4[1];\n\n  var firebase = useContext(FirebaseContext);\n\n  var _useContext = useContext(UserContext),\n      _useContext2 = _slicedToArray(_useContext, 2),\n      user = _useContext2[0],\n      setUser = _useContext2[1];\n\n  var _useContext3 = useContext(GroupContext),\n      _useContext4 = _slicedToArray(_useContext3, 2),\n      group = _useContext4[0],\n      setGroup = _useContext4[1];\n\n  var _useState5 = useState(true),\n      _useState6 = _slicedToArray(_useState5, 2),\n      CleanUp = _useState6[0],\n      setCleanUp = _useState6[1];\n\n  useEffect(function () {\n    if (CleanUp === true) {\n      RefreshGroupData();\n    }\n\n    return function () {\n      setCleanUp(false);\n    };\n  }, []);\n\n  var ChangeGroup = function ChangeGroup(_ref2) {\n    var item = _ref2.item;\n\n    try {\n      setGroup({\n        groupname: item.groupname,\n        groupID: item.groupID,\n        color: item.color,\n        members: item.members,\n        GroupPhotoUrl: item.GroupPhotoUrl\n      });\n      navigation.push(\"Groups\");\n    } catch (error) {\n      alert(\"Unable to set up groupContext\");\n    }\n  };\n\n  var RefreshGroupData = function RefreshGroupData() {\n    var value, parsedJson;\n    return _regeneratorRuntime.async(function RefreshGroupData$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            console.log(\"UserContext groups\", user.groups);\n            console.log(\"UserContext groups\", Groups);\n            firebase.CacheUserContext(user);\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"groups\"));\n\n          case 6:\n            value = _context.sent;\n\n            if (value !== null) {\n              parsedJson = JSON.parse(value);\n              console.log(\"1\", parsedJson);\n              setData(parsedJson);\n              setUser(function (state) {\n                return _objectSpread(_objectSpread({}, state), {}, {\n                  groups: parsedJson\n                });\n              });\n            } else {\n              console.log(\"Nothing was no groups in persistent storage\");\n            }\n\n            _context.next = 13;\n            break;\n\n          case 10:\n            _context.prev = 10;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(\"Something went wrong @GroupData\");\n\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 10]], Promise);\n  };\n\n  var renderItem = function renderItem(_ref3) {\n    var item = _ref3.item;\n    return _jsx(Box, {\n      maxW: \"100%\",\n      children: _jsxs(VStack, {\n        children: [_jsx(Divider, {}), _jsx(Pressable, {\n          onPress: function onPress() {\n            return ChangeGroup({\n              item: item\n            });\n          },\n          children: _jsx(Box, {\n            children: _jsxs(HStack, {\n              w: \"100%\",\n              h: \"70\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              bg: \"primary.50\",\n              children: [_jsx(Avatar, {\n                source: item.GroupPhotoUrl == \"default\" ? require(\"../../assets/default-group.png\") : {\n                  uri: item.GroupPhotoUrl\n                },\n                height: \"60\",\n                rounded: \"full\",\n                width: \"60\",\n                alt: \"GroupPhoto\"\n              }), _jsx(Text, {\n                bold: true,\n                fontSize: \"xl\",\n                children: item.groupname\n              }), _jsx(Ionicons, {\n                name: \"chevron-forward-outline\",\n                size: 30\n              })]\n            })\n          })\n        }), _jsx(Divider, {})]\n      })\n    });\n  };\n\n  var closeRow = function closeRow(rowMap, rowKey) {\n    if (rowMap[rowKey]) {\n      rowMap[rowKey].closeRow();\n    }\n  };\n\n  var deleteGroup = function deleteGroup(rowMap, rowKey, groupID) {\n    var newArray;\n    return _regeneratorRuntime.async(function deleteGroup$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(firebase.LeaveGroup(groupID));\n\n          case 3:\n            _context2.next = 5;\n            return _regeneratorRuntime.awrap(firebase.RemoveCacheGroupData(groupID));\n\n          case 5:\n            newArray = _context2.sent;\n            console.log(\"newarray\", newArray);\n\n            if (!(newArray === 1)) {\n              _context2.next = 11;\n              break;\n            }\n\n            console.log(\"No more groups\");\n            setUser(function (state) {\n              return _objectSpread(_objectSpread({}, state), {}, {\n                groups: []\n              });\n            });\n            return _context2.abrupt(\"return\");\n\n          case 11:\n            setUser(function (state) {\n              return _objectSpread(_objectSpread({}, state), {}, {\n                groups: newArray\n              });\n            });\n            setData(newArray);\n            closeRow(rowMap, rowKey);\n            _context2.next = 19;\n            break;\n\n          case 16:\n            _context2.prev = 16;\n            _context2.t0 = _context2[\"catch\"](0);\n            console.log(\"Something went wrong @deleteGroup\");\n\n          case 19:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 16]], Promise);\n  };\n\n  var renderHiddenItem = function renderHiddenItem(data, rowMap) {\n    return _jsx(HStack, {\n      flex: \"1\",\n      pl: \"2\",\n      alignItems: \"center\",\n      children: _jsx(Pressable, {\n        w: \"100\",\n        h: \"60\",\n        bg: \"red.500\",\n        justifyContent: \"center\",\n        ml: \"auto\",\n        onPress: function onPress() {\n          return deleteGroup(rowMap, data.item.key, data.item.groupID);\n        },\n        _pressed: {\n          opacity: 0.5\n        },\n        children: _jsxs(VStack, {\n          alignItems: \"center\",\n          space: 2,\n          children: [_jsx(Icon, {\n            as: _jsx(MaterialIcons, {\n              name: \"delete\"\n            }),\n            color: \"white\",\n            size: \"6\"\n          }), _jsx(Text, {\n            color: \"white\",\n            fontSize: \"xs\",\n            fontWeight: \"medium\",\n            children: \"Leave group\"\n          })]\n        })\n      })\n    });\n  };\n\n  return _jsxs(Box, {\n    children: [_jsxs(HStack, {\n      space: 12,\n      justifyContent: \"center\",\n      pt: \"10\",\n      children: [_jsx(Box, {\n        w: \"100\",\n        h: \"100\",\n        children: _jsx(Button, {\n          onPress: function onPress() {\n            return navigation.push(\"CreateGroup\");\n          },\n          height: \"50\",\n          width: \"110\",\n          leftIcon: _jsx(Icon, {\n            as: Ionicons,\n            name: \"create-outline\",\n            size: \"sm\"\n          }),\n          children: \"Create\"\n        })\n      }), _jsx(Box, {\n        children: _jsx(Button, {\n          onPress: function onPress() {\n            return navigation.push(\"joingroup\");\n          },\n          height: \"50\",\n          width: \"110\",\n          leftIcon: _jsx(Icon, {\n            as: Ionicons,\n            name: \"log-in-outline\",\n            size: \"sm\"\n          }),\n          children: \"Join\"\n        })\n      })]\n    }), _jsx(Box, {\n      children: _jsx(SwipeListView, {\n        useFlatList: true,\n        renderHiddenItem: renderHiddenItem,\n        rightOpenValue: -100,\n        leftOpenValue: 10000,\n        previewRowKey: \"0\",\n        previewOpenValue: -50,\n        previewOpenDelay: 3000,\n        data: data,\n        renderItem: renderItem,\n        keyExtractor: function keyExtractor(item) {\n          return item.groupID;\n        },\n        refreshControl: _jsx(RefreshControl, {\n          onRefresh: RefreshGroupData\n        })\n      })\n    })]\n  });\n};","map":{"version":3,"sources":["/Users/havardskjaerstein/Desktop/Achive/screens/GroupTab/HomeScreen.js"],"names":["React","useState","useContext","useEffect","AsyncStorage","MaterialIcons","Ionicons","Entypo","GroupContext","FirebaseContext","UserContext","SecureStore","SwipeListView","Box","Text","Pressable","Heading","IconButton","Icon","HStack","Avatar","VStack","Spacer","Center","Image","Divider","Stack","Button","HomeScreen","navigation","Groups","setGroups","data","setData","firebase","user","setUser","group","setGroup","CleanUp","setCleanUp","RefreshGroupData","ChangeGroup","item","groupname","groupID","color","members","GroupPhotoUrl","push","error","alert","console","log","groups","CacheUserContext","getItem","value","parsedJson","JSON","parse","state","renderItem","require","uri","closeRow","rowMap","rowKey","deleteGroup","LeaveGroup","RemoveCacheGroupData","newArray","renderHiddenItem","key","opacity"],"mappings":"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","sourcesContent":["import React, {useState, useContext, useEffect} from \"react\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { MaterialIcons, Ionicons, Entypo } from \"@expo/vector-icons\";\nimport {GroupContext} from \"../../context/GroupContext\";\nimport {FirebaseContext} from \"../../context/FirebaseContext\";\nimport {UserContext} from \"../../context/UserContext\";\nimport * as SecureStore from 'expo-secure-store';\nimport { SwipeListView } from \"react-native-swipe-list-view\";\nimport {Box, Text, Pressable, Heading, IconButton, Icon, HStack, Avatar, VStack, Spacer, Center, Image,Divider,Stack, Button} from \"native-base\";\nimport {RefreshControl} from 'react-native';\n\nexport default HomeScreen = ({navigation}) => {\n  \n  const [Groups, setGroups] = useState([]); \n  const [data, setData] = useState([]); \n  const firebase = useContext(FirebaseContext); \n  const [user, setUser] = useContext(UserContext); \n  const [group, setGroup] = useContext(GroupContext); \n  const [CleanUp, setCleanUp] = useState(true); \n\n  useEffect(() => {\n  \n    if(CleanUp === true){\n      RefreshGroupData();  \n    }\n    return () => {setCleanUp(false)};\n  }, []);\n\n  const ChangeGroup = ( {item} ) => {\n    try{\n\n      setGroup({\n        groupname: item.groupname, \n        groupID: item.groupID, \n        color:  item.color, \n        members: item.members, \n        GroupPhotoUrl: item.GroupPhotoUrl,\n      })\n\n      navigation.push(\"Groups\"); \n\n    }catch(error){\n      alert(\"Unable to set up groupContext\")\n    }\n  }\n\n  //Henter enten ut fra persistent storage eller så hentes det fra databasen og lagres der\n  const RefreshGroupData = async () => {\n \n    try{\n\n      console.log(\"UserContext groups\",user.groups); \n      console.log(\"UserContext groups\",Groups); \n\n      //kanskje man må oppdatere group contexten også \n\n      firebase.CacheUserContext(user); \n\n      const value = await AsyncStorage.getItem(\"groups\");\n\n      if (value !== null) {\n        \n        //Hent ut data fra async storage\n        const parsedJson = JSON.parse(value)\n        console.log(\"1\",parsedJson)\n\n        setData(parsedJson); \n        //updates the user context with the groups\n        setUser((state) => ({ ...state, groups: parsedJson})); \n\n      }else{\n       console.log(\"Nothing was no groups in persistent storage\") \n      }\n      }catch {  \n        console.log(\"Something went wrong @GroupData\");\n    }\n  }\n\n  const renderItem = ({\n    item\n  }) => \n      <Box maxW=\"100%\">\n        <VStack >\n          <Divider />\n          <Pressable onPress={() => ChangeGroup({item})} >\n            <Box>\n            <HStack w=\"100%\" h=\"70\" justifyContent=\"space-between\" alignItems=\"center\" bg=\"primary.50\">\n              \n            <Avatar\n                  source={item.GroupPhotoUrl == \"default\"\n                        ? require(\"../../assets/default-group.png\")\n                        : { uri: item.GroupPhotoUrl}\n                } height=\"60\" rounded=\"full\" width=\"60\" alt=\"GroupPhoto\">\n                  </Avatar> \n                <Text bold fontSize=\"xl\" >\n                  {item.groupname}\n                </Text>\n                <Ionicons \n                    name={\"chevron-forward-outline\"} \n                    size={30} />\n              </HStack>\n            </Box>\n          </Pressable>\n          <Divider />\n        </VStack>\n      </Box>;\n\n\nconst closeRow = (rowMap, rowKey) => {\n  if (rowMap[rowKey]) {\n    rowMap[rowKey].closeRow();\n  }\n};\n\nconst deleteGroup = async (rowMap, rowKey, groupID) => {\n\n  try{\n    //leaves the groups on the database\n    await firebase.LeaveGroup(groupID); \n\n    //removes the groups from the cache and updates the usercache\n    const newArray = await firebase.RemoveCacheGroupData(groupID)\n    console.log(\"newarray\", newArray) \n    \n    if(newArray === 1){\n      console.log(\"No more groups\")\n      setUser((state) => ({ ...state, groups:[] })); \n      return; \n    }\n\n\n    setUser((state) => ({ ...state, groups: newArray})); \n    setData(newArray); \n    closeRow(rowMap, rowKey);\n  \n    } catch {\n      console.log(\"Something went wrong @deleteGroup\")\n    }\n};\n\nconst renderHiddenItem = (data, rowMap) => \n  <HStack flex=\"1\" pl=\"2\" alignItems=\"center\">\n    <Pressable w=\"100\" h=\"60\" bg=\"red.500\" justifyContent=\"center\"  ml=\"auto\" \n      onPress={() => deleteGroup(rowMap, data.item.key, data.item.groupID)} _pressed={{opacity: 0.5}}>\n      <VStack alignItems=\"center\" space={2}>\n        <Icon as={<MaterialIcons name=\"delete\" />} color=\"white\" size=\"6\" />\n        <Text color=\"white\" fontSize=\"xs\" fontWeight=\"medium\">\n          Leave group\n        </Text>\n      </VStack>\n    </Pressable>\n  </HStack>;\n\n  return(\n    <Box>\n      <HStack space={12} justifyContent=\"center\" pt=\"10\" >\n          <Box w=\"100\" h=\"100\">\n            <Button onPress={() => navigation.push(\"CreateGroup\")} height=\"50\" width=\"110\" leftIcon={<Icon as={Ionicons} name=\"create-outline\" size=\"sm\"  />}>\n              Create\n            </Button>\n          </Box>\n   \n          <Box>\n            <Button onPress={() => navigation.push(\"joingroup\")} height=\"50\" width=\"110\" leftIcon={<Icon as={Ionicons} name=\"log-in-outline\" size=\"sm\"  />}>\n              Join\n            </Button>\n          </Box>\n      </HStack>\n      <Box>\n        <SwipeListView  \n          useFlatList={true}\n          renderHiddenItem={renderHiddenItem} \n          rightOpenValue={-100}\n          leftOpenValue={10000}\n          previewRowKey={\"0\"} \n          previewOpenValue={-50} \n          previewOpenDelay={3000} \n          data={data}\n          renderItem={renderItem}\n          keyExtractor={item => item.groupID}\n          refreshControl={<RefreshControl onRefresh={RefreshGroupData}/>}\n        /> \n      </Box>\n    </Box>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}